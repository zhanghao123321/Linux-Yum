name: Sync LinuxMirrors

on:
  schedule:
    # 每天凌晨1点运行同步任务
    - cron: '0 1 * * *'
  workflow_dispatch:
    # 手动触发

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
    - name: Setup SSH key
      uses: webfactory/ssh-agent@v0.5.3
      with:
        ssh-private-key: ${{ secrets.ACTIONS_DEPLOY_KEY }}

    - name: Checkout source repository
      uses: actions/checkout@v2
      with:
        repository: SuperManito/LinuxMirrors
        path: src

    - name: Configure Git
      run: |
        git config --global user.name 'github-actions[bot]'
        git config --global user.email 'github-actions[bot]@users.noreply.github.com'
    
    - name: Sync repository
      run: |
        cd src
        git remote set-url origin git@github.com:zhanghao123321/Linux-Yum.git
        git fetch origin
        git reset --hard origin/main
        git push origin HEAD:main --force

    - name: Push changes
      run: |
        cd src
        git push origin main
